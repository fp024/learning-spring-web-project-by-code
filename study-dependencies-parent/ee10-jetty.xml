<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
 
  <!--
    Jetty 12 ë¶€í„°ëŠ” groupIdì™€ artifactIdê°€ ë°”ë€Œì–´ì„œ ë”°ë¡œ ë³„ë„ ì„¤ì • pomì„ ë¶„ë¦¬í–ˆìŒ.
  -->
  <parent>
    <groupId>org.fp024</groupId>
    <artifactId>study-dependencies-parent</artifactId>
    <version>1.0.0-BUILD-SNAPSHOT</version>
    <relativePath>pom.xml</relativePath>
  </parent>

  <artifactId>study-dependencies-parent-with-ee10-jetty</artifactId>
  <name>${project.artifactId}</name>
  <packaging>pom</packaging>
 
  <properties>
    <jetty.version>${jetty12.version}</jetty.version>
  </properties>
 
  <profiles>
    <!-- Jetty ê¸°ë³¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰  -->
    <profile>
      <id>jetty-run</id>
      <!-- 
        ì—¬ê¸°ì„œ activeByDefaultë¥¼ true ì§€ì •í•´ë²„ë¦¬ë©´ ì´ í”„ë¡œí•„ì— ì†í•œ propertiesê°€ ë¬´ì¡°ê±´ ìš°ì„  ëœë‹¤. 
        ìƒìœ„ì˜ tomcat-run í”„ë¡œí•„ì„ ì„¤ì •í•´ì„œ ì‹¤í–‰í•˜ë”ë¼ë„ jstl-scope.type ì†ì„± ê°’ì´ providedë¡œ ë®ì–´ì”Œì–´ ì ¸ë²„ë¦¼.
        í˜¼ëž€ ë°©ì§€ë¥¼ ìœ„í•´ ì„¤ì • ì œê±°í•´ë†”ì•¼ê² ë‹¤.
        
        ê·¸ëž˜ë„ ë¶ˆíŽ¸í•œ ì ì´ ìƒê¸°ê¸´í•¨.. jetty ì‹¤í–‰ì‹œ í”„ë¡œí•„ì„ ê¼­ ì§€ì •í•´ì•¼í•¨.
      -->
      <!--
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      -->
      <properties>
        <jstl-scope.type>provided</jstl-scope.type>
      </properties>
      <build>
        <plugins>
          <!-- Jetty ì„œë²„ êµ¬ë™ -->
          <!-- ë„ì›€ë§ ìžì„¸ížˆë³´ê¸°: mvnw jetty:help -Ddetail=true -Dgoal=run -->
          <plugin>
            <!-- https://eclipse.dev/jetty/documentation/jetty-12/programming-guide/index.html#jetty-maven-plugin -->
            <!-- ë¬¸ì„œì—ëŠ” ì–¸ê¸‰ì´ ë”°ë¡œ ì—†ìŒ. -->
            <!-- https://eclipse.dev/jetty/documentation/jetty-12/programming-guide/index.html#pg-migration-11-to-12 -->
            <!-- ì—¬ê¸°ì„œëŠ” ê°€ì´ë“œê°€ ìžˆê¸´í•œë°.. ì—¬ì „ížˆ groupIdê°€ ìž˜ëª»ëœ ê²ƒ ê°™ì€ë°...ðŸ˜… 
                org.eclipse.jetty.ee{8,9,10}:jetty-ee{8,9,10}-jetty-maven-plugin ê°€ ì•„ë‹ˆê³ ,
                org.eclipse.jetty.ee{8,9,10}:jetty-ee{8,9,10}-maven-plugin ê°€ ë˜ì•¼í•˜ëŠ” ê²ƒì´ ì•„ë‹Œì§€?
            -->
            <groupId>org.eclipse.jetty.ee10</groupId>
            <artifactId>jetty-ee10-maven-plugin</artifactId>
            <version>${jetty.version}</version>
            <configuration>
              <httpConnector>
                <!--host>localhost</host-->
                <port>${jetty.port}</port>
              </httpConnector>
              <webApp>
                <contextPath>${jetty-context-path}</contextPath>
                <sessionHandler>
                  <sessionIdPathParameterName>none</sessionIdPathParameterName>
                </sessionHandler>
              </webApp>
              <deployMode>EMBED</deployMode>
              <stopKey>CTRL+C</stopKey>
              <stopPort>8999</stopPort>
              <!-- 9.x ì„¤ì •: <scanIntervalSeconds> ëŒ€ì‹  <scan> ì‚¬ìš© -->
              <!-- 
                ë³€ê²½ ê°ì§€ ìžë™ ìž¬ì‹œìž‘ì‹œ ContextLoaderListenerê°€ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
                ì„¤ì •ì„ -1ë¡œí•˜ì—¬ ìžë™ ìž¬ì‹œìž‘ì´ ì¼ì–´ë‚˜ì§€ ì•Šë„ë¡ í•œë‹¤.
               -->
              <scan>${jetty-auto-deploy-seconds}</scan>
              <scanTargetPatterns>
                <scanTargetPattern>
                  <directory>src/main/webapp/WEB-INF</directory>
                  <includes>
                    <include>**/*.properties</include>
                    <include>**/*.xml</include>
                  </includes>
                  <excludes>
                    <exclude>**/*.jsp</exclude>
                  </excludes>
                </scanTargetPattern>
              </scanTargetPatterns>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>

    <!-- Jetty - Scouterë¥¼ í™œì„±í™”í•˜ì—¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ -->
    <profile>
      <id>jetty-run-with-scouter</id>
      <properties>
        <jstl-scope.type>provided</jstl-scope.type>
      </properties>
      <build>
        <plugins>
          <!-- Jetty ì„œë²„ êµ¬ë™ -->
          <!-- ë„ì›€ë§ ìžì„¸ížˆë³´ê¸°: mvnw jetty:help -Ddetail=true -Dgoal=run -->
          <plugin>
            <!-- https://www.eclipse.org/jetty/documentation/jetty-10/programming-guide/index.html#jetty-maven-plugin -->
            <groupId>org.eclipse.jetty.ee10</groupId>
            <artifactId>jetty-ee10-maven-plugin</artifactId>
            <version>${jetty.version}</version>
            <configuration>
              <httpConnector>
                <!--host>localhost</host-->
                <port>${jetty.port}</port>
              </httpConnector>
              <!-- jvmArgsëŠ” FORK ëª¨ë“œì—ì„œë§Œ ë™ìž‘í•œë‹¤. -->
              <jvmArgs><!-- 
                  -->-javaagent:${scouter.agent.lib} <!--
                  -->--illegal-access=warn <!--
                  -->--add-opens=java.base/java.lang=ALL-UNNAMED <!--
                  -->-Djdk.attach.allowAttachSelf=true <!--
                  -->-Dscouter.config=${project.basedir}/../../${scouter.config.file} <!--
              --></jvmArgs>
              <webApp>
                <contextPath>${jetty-context-path}</contextPath>
                <sessionHandler>
                  <sessionIdPathParameterName>none</sessionIdPathParameterName>
                </sessionHandler>
              </webApp>
              <deployMode>FORK</deployMode>
              <stopKey>CTRL+C</stopKey>
              <stopPort>8999</stopPort>
              <!-- 9.x ì„¤ì •: <scanIntervalSeconds> ëŒ€ì‹  <scan> ì‚¬ìš© -->
              <!-- 
                ë³€ê²½ ê°ì§€ ìžë™ ìž¬ì‹œìž‘ì‹œ ContextLoaderListenerê°€ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
                ì„¤ì •ì„ -1ë¡œí•˜ì—¬ ìžë™ ìž¬ì‹œìž‘ì´ ì¼ì–´ë‚˜ì§€ ì•Šë„ë¡ í•œë‹¤.
               -->
              <scan>${jetty-auto-deploy-seconds}</scan>
              <scanTargetPatterns>
                <scanTargetPattern>
                  <directory>src/main/webapp/WEB-INF</directory>
                  <includes>
                    <include>**/*.properties</include>
                    <include>**/*.xml</include>
                  </includes>
                  <excludes>
                    <exclude>**/*.jsp</exclude>
                  </excludes>
                </scanTargetPattern>
              </scanTargetPatterns>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>   
  </profiles>
</project>
